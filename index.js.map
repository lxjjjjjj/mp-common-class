{"version":3,"file":"index.js","sources":["src/index.js"],"sourcesContent":["const { collectClass } = require('./collectClass.js')\nconst { compareSubpackageClass, compareClass} = require('./compareClass.js')\nconst { normalizeSubpackageClass, normalizeClass} = require('./normalizeClass.js')\nconst { normalizeFiles } = require('./normalizeFiles.js')\nconst { flattenAndUnique } = require('./utils.js')\n\n\nconst init = async ({commonStyle, fileRoot, cssName, mainPackage, subPackage, specSubPackage }) =>{\n  let errno = 0, msg = '编译完成'\n\n  if(mainPackage && !fileRoot){\n    msg = '如果是需要提取整个文件的公共样式, 需要写扫描文件入口! 如果不需要可以不传 mainPackage 参数'\n    errno = 1\n    return new Promise((resolve, reject)=>{\n      resolve({\n        msg,\n        errno\n      })\n    })\n  }\n\n  if(subPackage && specSubPackage &&!specSubPackage.length && !fileRoot){\n    msg = '如果是需要提取所有分包的公共样式, 需要写扫描文件入口! 如果提取部分分包的公共样式需要添加 subpackagefileDir 参数'\n    errno = 2\n    return new Promise((resolve, reject)=>{\n      resolve({\n        msg,\n        errno\n      })\n    })\n  }\n\n  if(!subPackage && !mainPackage){\n    msg = '请设置扫描主包或者分包'\n    errno = 3\n    return new Promise((resolve, reject)=>{\n      resolve({\n        msg,\n        errno\n      })\n    })\n  }\n\n  if(!cssName){\n    cssName = 'wxss'\n    msg = '如果没有传css文件后缀默认文件后缀为wxss'\n    errno = 0\n  }\n\n  if(!commonStyle){\n    commonStyle = `commonStyle`\n    msg = '如果没有设定公共样式文件名称，默认为名为commonStyle'\n    errno = 0\n  }\n\n\n  \n  await normalizeFiles({fileRoot, cssName, mainPackage, subPackage, specSubPackage}).then(res=>{\n    const {mainfiles, subpackagefiles} = res\n    Promise.all([collectClass(mainfiles),collectClass(subpackagefiles)]).then((res)=>{\n      const files = Object.assign({},subpackagefiles,mainfiles)\n      mainPackage && normalizeClass(files,compareClass(flattenAndUnique(Object.assign({},res[0],res[1]), fileRoot)),fileRoot, commonStyle, cssName)\n    }).then(()=>{\n      collectClass(subpackagefiles).then((res)=>{\n        subPackage && normalizeSubpackageClass(subpackagefiles, compareSubpackageClass(res), commonStyle, cssName)\n      })\n    })\n  })\n  return new Promise((resolve, reject)=>{\n    resolve({\n      msg,\n      errno\n    })\n  })\n}\n\nconst getCommonClass = ({weight,css,commonCssName,outputFilePath,subpackageArr}) => {\n  if(!subpackageArr.length) return \n  let files = {}\n  subpackageArr.length && subpackageArr.forEach(item=>{\n    files[item] = [item + '/' + css]\n  })\n  let [ commonStyle, cssName ] = commonCssName.split('.')\n  collectClass(files).then((res)=>{\n    normalizeClass(files,compareClass(flattenAndUnique(res,outputFilePath), weight),outputFilePath, commonStyle, cssName)\n  })\n}\nmodule.exports = {\n  init,\n  getCommonClass\n}"],"names":["collectClass","require","compareSubpackageClass","compareClass","normalizeSubpackageClass","normalizeClass","normalizeFiles","flattenAndUnique","init","commonStyle","fileRoot","cssName","mainPackage","subPackage","specSubPackage","errno","msg","Promise","resolve","reject","length","then","res","mainfiles","subpackagefiles","all","files","Object","assign","module","exports","getCommonClass","weight","css","commonCssName","outputFilePath","subpackageArr","forEach","item","split"],"mappings":"gpCAAA,IAAQA,EAAiBC,QAAQ,qBAAzBD,eACwCC,QAAQ,qBAAhDC,IAAAA,uBAAwBC,IAAAA,eACoBF,QAAQ,uBAApDG,IAAAA,yBAA0BC,IAAAA,eAC1BC,EAAmBL,QAAQ,uBAA3BK,eACAC,EAAqBN,QAAQ,cAA7BM,iBAGFC,gDAAO,oHAAQC,IAAAA,YAAaC,IAAAA,SAAUC,IAAAA,QAASC,IAAAA,YAAaC,IAAAA,WAAYC,IAAAA,eACxEC,EAAQ,EAAGC,EAAM,OAElBJ,IAAgBF,SACjBM,EAAM,wDACND,EAAQ,oBACD,IAAIE,QAAQ,SAACC,EAASC,GAC3BD,EAAQ,CACNF,IAAAA,EACAD,MAAAA,gCAKHF,GAAcC,IAAkBA,EAAeM,SAAWV,SAC3DM,EAAM,sEACND,EAAQ,oBACD,IAAIE,QAAQ,SAACC,EAASC,GAC3BD,EAAQ,CACNF,IAAAA,EACAD,MAAAA,kCAKFF,GAAeD,0BACjBI,EAAM,cACND,EAAQ,oBACD,IAAIE,QAAQ,SAACC,EAASC,GAC3BD,EAAQ,CACNF,IAAAA,EACAD,MAAAA,sBAKFJ,IACFA,EAAU,OACVK,EAAM,0BACND,EAAQ,GAGNN,IACFA,gBACAO,EAAM,kCACND,EAAQ,aAKJT,EAAe,CAACI,SAAAA,EAAUC,QAAAA,EAASC,YAAAA,EAAaC,WAAAA,EAAYC,eAAAA,IAAiBO,KAAK,SAAAC,OAC/EC,EAA8BD,EAA9BC,UAAWC,EAAmBF,EAAnBE,gBAClBP,QAAQQ,IAAI,CAACzB,EAAauB,GAAWvB,EAAawB,KAAmBH,KAAK,SAACC,OACnEI,EAAQC,OAAOC,OAAO,GAAGJ,EAAgBD,GAC/CX,GAAeP,EAAeqB,EAAMvB,EAAaI,EAAiBoB,OAAOC,OAAO,GAAGN,EAAI,GAAGA,EAAI,IAAKZ,IAAWA,EAAUD,EAAaE,KACpIU,KAAK,WACNrB,EAAawB,GAAiBH,KAAK,SAACC,GAClCT,GAAcT,EAAyBoB,EAAiBtB,EAAuBoB,GAAMb,EAAaE,0CAIjG,IAAIM,QAAQ,SAACC,EAASC,GAC3BD,EAAQ,CACNF,IAAAA,EACAD,MAAAA,mRAgBNc,OAAOC,QAAU,CACftB,KAAAA,EACAuB,eAbqB,gBAEjBL,EAIEjB,EAAaE,EANIqB,IAAAA,OAAOC,IAAAA,IAAIC,IAAAA,cAAcC,IAAAA,eAAeC,IAAAA,cAC3DA,EAAchB,SACdM,EAAQ,GACZU,EAAchB,QAAUgB,EAAcC,QAAQ,SAAAC,GAC5CZ,EAAMY,GAAQ,CAACA,EAAO,IAAML,SAECC,EAAcK,MAAM,QAA7C9B,OAAaE,OACnBX,EAAa0B,GAAOL,KAAK,SAACC,GACxBjB,EAAeqB,EAAMvB,EAAaI,EAAiBe,EAAIa,GAAiBH,GAAQG,EAAgB1B,EAAaE"}